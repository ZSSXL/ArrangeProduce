<div class="page-header">
    <div class="container-fluid">
        <h2 class="h5 no-margin-bottom">排产</h2>
    </div>
</div>
<section class="no-padding-top">

    <!-- 模态框 -->
    <div class="modal fade" tabindex="-1" role="dialog" id="load-modal">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content" id="modal-area">
                <!-- 模态框内容动态加载 -->
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <!-- 详情打印 -->
    <div class="modal fade" tabindex="-1" role="dialog" id="detail-print-modal">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">PRINT 打印操作</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <!--startprint-->
                        <div class="col-lg-6 col-sm-6">
                            <img id="qr-code" src="/img/photos/default.png">
                        </div>
                        <div class="col-lg-6 col-sm-6">
                            <h3>机器&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span id="machine-name"></span></h3>
                            <h3>线规&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span id="gauge-value"></span></h3>
                            <h3>公差&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span id="tolerance-value"></span>
                            </h3>
                            <h3>重量&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span id="weight-value"></span></h3>
                            <h3>生产时间&nbsp;: <span id="arrange-time"></span></h3>
                            <h3>班次&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span id="shift-value"></span></h3>
                        </div>
                        <!--endprint-->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-light" data-dismiss="modal">取消</button>
                    <button id="start-print" type="button" class="btn btn-primary">打印</button>
                </div>

                <script type="text/javascript">
                    $("#start-print").click(function () {
                        preview();
                    });

                    function preview() {
                        console.log("start print ...");
                        const bdhtml = window.document.body.innerHTML; //获取当前页的html代码
                        const startStr = "<!--startprint-->"; //设置打印开始区域
                        const endStr = "<!--endprint-->"; //设置打印结束区域
                        //从标记里获取需要打印的页面
                        window.document.body.innerHTML = bdhtml.substring(bdhtml.indexOf(startStr) + startStr.length, bdhtml.indexOf(endStr)); //需要打印的页面
                        window.print();
                        window.document.body.innerHTML = bdhtml; //还原界面
                        location.reload();
                        console.log("end print ...");
                    }
                </script>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <!-- 模态框 -->
    <div class="modal fade" tabindex="-1" role="dialog" id="arrange-detail-modal">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <!-- 模态框内容动态加载 -->
                <div class="modal-header">
                    <h4 class="modal-title">ARRANGE 线规详情</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="block-body">
                        <div class="form-group row">
                            <div class="col-lg-6 col-sm-6">
                                <div class="row">
                                    <h4 class="col-sm-3">线规<small>(mm)</small></h4>
                                    <div class="col-sm-9">
                                        <input type="text" placeholder="gauge"
                                               class="form-control form-control-success" id="detail-gauge"
                                               value="0.0598">
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-sm-6">
                                <div class="row">
                                    <h4 class="col-sm-3">公差<small>(mm)</small></h4>
                                    <div class="col-sm-9">
                                        <input type="text" placeholder="tolerance"
                                               class="form-control form-control-success" id="detail-tolerance">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-lg-6 col-sm-6">
                                <div class="row">
                                    <h4 class="col-sm-3">班次</h4>
                                    <div class="col-sm-9">
                                        <input type="text" placeholder="shift"
                                               class="form-control form-control-success" id="detail-shift">
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-sm-6">
                                <div class="row">
                                    <h4 class="col-sm-3">重量<small>(kg)</small></h4>
                                    <div class="col-sm-9">
                                        <input type="text" placeholder="weight"
                                               class="form-control form-control-success" id="detail-weight">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-lg-6 col-sm-6">
                                <div class="row">
                                    <h4 class="col-sm-3">创建人</h4>
                                    <div class="col-sm-9">
                                        <input type="text" disabled="" placeholder="creator"
                                               class="form-control form-control-success" id="detail-creator">
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-sm-6">
                                <div class="row">
                                    <h4 class="col-sm-3">小拉机</h4>
                                    <div class="col-sm-9">
                                        <input type="text" placeholder="draw machine"
                                               class="form-control form-control-success" id="detail-machine">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-lg-6 col-sm-6">
                                <div class="row">
                                    <h4 class="col-sm-4">创建时间</h4>
                                    <div class="col-sm-8">
                                        <input type="text" disabled="" placeholder="create time"
                                               class="form-control form-control-success" id="detail-create-time">
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-sm-6">
                                <div class="row">
                                    <h4 class="col-sm-4">生产时间</h4>
                                    <div class="col-sm-8">
                                        <input type="text" placeholder="arrange time"
                                               class="form-control form-control-success" id="detail-arrange-time">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-lg-6 col-sm-6">
                                <div class="row">
                                    <h4 class="col-sm-4">打印状态</h4>
                                    <div class="col-sm-8">
                                        <input type="text" disabled="" placeholder="print status"
                                               class="form-control form-control-success" id="detail-print">
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-sm-6">
                                <div class="row">
                                    <h4 class="col-sm-4">推送状态</h4>
                                    <div class="col-sm-8">
                                        <input type="text" disabled="" placeholder="push status"
                                               class="form-control form-control-success" id="detail-push">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-info" id="modify-arrange">修改</button>
                    <button type="button" class="btn btn-outline-warning" id="print-history">打印</button>
                    <button type="button" class="btn btn-outline-light" data-dismiss="modal">Close</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div class="container-fluid block">
        <div class="row">
            <!-- Form Elements -->
            <div class="col-lg-12">
                <div class="block-body">
                    <div class="form-group row">
                        <label class="col-lg-2 col-sm-2 form-control-label">
                            <h4 class="text-white">小拉机</h4>
                        </label>
                        <div class="col-lg-7 col-sm-7">
                            <select id="machine" name="machine" class="form-control mb-3 mb-3">
                            </select>
                        </div>
                        <div class="col-lg-2 col-sm-2">
                            <button class="btn btn-outline-warning" id="machine-setting">设置</button>
                        </div>
                    </div>
                    <div class="line"></div>
                    <div class="form-group row">
                        <label class="col-lg-2 col-sm-2 form-control-label">
                            <h4 class="text-white">线规(mm)</h4>
                        </label>
                        <div class="col-lg-7 col-sm-7">
                            <select id="gauge" name="gauge" class="form-control mb-3 mb-3">
                            </select>
                        </div>
                        <div class="col-lg-2 col-sm-2">
                            <button class="btn btn-outline-warning" id="gauge-setting">设置</button>
                        </div>
                    </div>
                    <div class="line"></div>
                    <div class="form-group row">
                        <label class="col-sm-2 form-control-label">
                            <h4 class="text-white">公差(mm)</h4>
                        </label>
                        <div class="col-sm-10">
                            <input id="tolerance" type="text" class="form-control" placeholder="例: +0.005">
                            <small class="text-primary">请注意正负符号不要遗漏</small>
                        </div>
                    </div>
                    <div class="line"></div>
                    <div class="form-group row">
                        <label class="col-sm-2 form-control-label">
                            <h4 class="text-white">重量(kg)</h4>
                        </label>
                        <div class="col-sm-10">
                            <input id="weight" type="text" class="form-control" value="">
                        </div>
                    </div>
                    <div class="line"></div>
                    <div class="form-group row">
                        <label class="col-sm-2 form-control-label">
                            <h4 class="text-white">生产时间</h4>
                        </label>
                        <div class="col-sm-10">
                            <input id="arrange-date" type="date" class="form-control">
                        </div>
                    </div>
                    <div class="line"></div>
                    <div class="form-group row">
                        <label class="col-lg-2 col-sm-2 form-control-label">
                            <h4 class="text-white">班次</h4>
                        </label>
                        <div class="col-lg-2 col-sm-3">
                            <div class="i-checks">
                                <input id="radioCustom2" type="radio" checked="" value="1" name="shift"
                                       class="radio-template">
                                <label for="radioCustom2">早班</label>
                            </div>
                        </div>
                        <div class="col-lg-7 col-sm-3">
                            <div class="i-checks">
                                <input id="radioCustom1" type="radio" value="0" name="shift"
                                       class="radio-template">
                                <label for="radioCustom1">晚班</label>
                            </div>
                        </div>
                    </div>
                    <div class="line"></div>
                    <div class="form-group row">
                        <div class="col-lg-10 col-sm-10 ml-auto">
                            <button id="save-btn" type="submit" class="btn btn-outline-info">保存</button>
                            <button id="reset-btn" class="btn btn-outline-secondary">重置</button>
                            <button id="print-btn" type="submit" class="btn btn-outline-warning">打印预览</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<section class="no-padding-top no-padding-bottom">
    <div class="container-fluid block" id="load-area">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12">
                <div class="row">
                    <div class="col-lg-3 col-sm-3">
                        <div class="input-group">
                            <div class="input-group-prepend"><span class="input-group-text text-white"><i
                                    class="icon-magnifying-glass-browser"></i></span></div>
                            <input id="input-filter-arrange" type="text" placeholder="输入过滤条件" class="form-control">
                        </div>
                    </div>
                    <div class="col-lg-7 col-sm-7">
                        <button class="btn quick-click" style="background:#90c5f0;color:#fff;" tag-id="早班">早班</button>
                        <button class="btn quick-click" style="background:#8E388E;color:#fff;" tag-id="晚班">晚班</button>
                        <button class="btn quick-click" style="background:#A2CD5A;color:#fff;" tag-id="已推送">已推送</button>
                        <button class="btn quick-click" style="background:#FFA500;color:#fff;" tag-id="未推送">未推送</button>
                        <button class="btn quick-click" style="background:#00C5CD;color:#fff;" tag-id="">重置</button>
                    </div>
                    <div class="col-lg-2 col-sm-2">
                        <button class="btn btn-warning btn-lg" style="float: right;" id="push">推送</button>
                    </div>
                </div>
                <hr/>
                <div class="row">
                    <table id="sampleTable" class="table table-striped table-sm">
                        <thead class="text-center text-white">
                        <tr>
                            <th class="sorter-false">全选<input type="checkbox" id="ck"></th>
                            <th class="sorter-false">#</th>
                            <th class="sorter-false">设备</th>
                            <th>线规(mm)</th>
                            <th>公差(mm)</th>
                            <th class="sorter-false">重量(kg)</th>
                            <th>安排时间</th>
                            <th class="sorter-false">班次</th>
                            <th class="sorter-false">推送状态</th>
                            <th class="sorter-false">操作</th>
                        </tr>
                        </thead>
                        <tbody id="arrange-history-area" class="text-center">
                        </tbody>
                    </table>
                </div>
                <div class="text-center">
                    <div class="row">
                        <div class="col-lg-12 col-sm-12 text-center">
                            <h3 id="no-message">没有数据</h3>
                        </div>
                    </div>
                    <div class="row text-center" id="nav-message">
                        <!-- 分页信息 -->
                        <!-- 分页文字信息 -->
                        <div class="col-lg-12 col-sm-12" id="page_info_area"
                             style="text-align: center; margin-bottom: 10px;">
                        </div>
                        <!-- 分页条信息 -->
                        <div class="col-lg-12 col-sm-12" style="display: inline-block; text-align: center;">
                            <nav id="page-ul">
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


<!-- javascript -->
<script src="js/function/arrange.js"></script>
<script src="js/jquery.tablesorter.min.js"></script>
<script type="text/javascript">

    $("#gauge-setting").click(function () {
        $("#modal-area").load("/sub/gauge.html");
        getAllGauge();
        $("#load-modal").modal("show");
    });

    $("#machine-setting").click(function () {
        $("#modal-area").load("/sub/machine.html");
        getAllDraw();
        $("#load-modal").modal("show");
    });

    function getAllGauge() {
        $.ajax({
            url: serverUrl + "/gauge",
            contentType: "application/json; charset=utf-8",
            beforeSend: function (XMLHttpRequest) {
                XMLHttpRequest.setRequestHeader("token", token);
            },
            type: "GET",
            success: function (result) {
                if (result.status === 0) {
                    showGaugeHad(result.data);
                } else {
                    Notiflix.Notify.Failure(result.msg);
                }
            }
        });
    }

    /**
     * 获取所有小拉机信息
     */
    function getAllDraw() {
        $.ajax({
            url: serverUrl + "/machine/draw",
            contentType: "application/json; charset=utf-8",
            beforeSend: function (XMLHttpRequest) {
                XMLHttpRequest.setRequestHeader("token", token);
            },
            type: "GET",
            success: function (result) {
                if (result.status === 0) {
                    showMachineHad(result.data)
                } else {
                    Notiflix.Notify.Failure(result.msg);
                }
            }
        });
    }

    function showGaugeHad(data) {
        $("#gauge-area").empty();
        $.each(data, function (index, item) {
            let gaugeDiv = $("<div class='delete-gauge' style='cursor: pointer;' data-placement='top' title='点击删除'></div>").append(item.gauge.toFixed(3)).attr("gauge-id", item.gaugeId);
            $("<div class='col-lg-2 col-sm-3 text-center'></div>").append(gaugeDiv).appendTo("#gauge-area");
        });
    }

    function showMachineHad(data) {
        $("#machine-area").empty();
        $.each(data, function (index, item) {
            let machineDiv = $("<div class='delete-machine' style='cursor: pointer;' data-placement='top'></div>")
                .append(item.machineName + "(" + item.machineNumber + ")").attr({
                    "machine-id": item.machineId,
                    "title": "点击删除"
                });
            $("<div class='col-lg-2 col-sm-3 text-center'></div>").append(machineDiv).appendTo("#machine-area");
        });
    }

    $(function () {
        $("table").tablesorter({
            sortReset: true
        });
        /* $("table").filterTable({
             inputSelector: '#input-filter-arrange'
         });*/
        $("#input-filter-arrange").keyup(function () {
            filterTable($(this).val());
        }).keyup();
    });

    $(".quick-click").click(function () {
        let tag = $(this).attr("tag-id");
        filterTable(tag);
    });

    function filterTable(val) {
        $("table tbody tr").hide()
            .filter(":contains('" + (val) + "')").show();//filter和contains共同来实现了这个功能。
    }
</script>