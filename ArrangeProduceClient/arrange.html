<div class="page-header">
    <div class="container-fluid">
        <h2 class="h5 no-margin-bottom">排产</h2>
    </div>
</div>
<section class="no-padding-top">

    <!-- 模态框 -->
    <div class="modal fade" tabindex="-1" role="dialog" id="load-modal">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content" id="modal-area">
                <!-- 模态框内容动态加载 -->
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div class="container-fluid">
        <div class="row">
            <!-- Form Elements -->
            <div class="col-lg-12">
                <div class="block">
                    <div class="block-body">
                        <div class="form-group row">
                            <label class="col-lg-3 col-sm-3 form-control-label">
                                <h3>小拉机</h3>
                            </label>
                            <div class="col-lg-7 col-sm-7">
                                <select id="machine" name="machine" class="form-control mb-3 mb-3">
                                </select>
                            </div>
                            <div class="col-lg-2 col-sm-2">
                                <button class="btn btn-outline-warning" id="machine-setting">设置</button>
                            </div>
                        </div>
                        <div class="line"></div>
                        <div class="form-group row">
                            <label class="col-lg-3 col-sm-3 form-control-label">
                                <h3>线规(mm)</h3>
                            </label>
                            <div class="col-lg-7 col-sm-7">
                                <select id="gauge" name="gauge" class="form-control mb-3 mb-3">
                                </select>
                            </div>
                            <div class="col-lg-2 col-sm-2">
                                <button class="btn btn-outline-warning" id="gauge-setting">设置</button>
                            </div>
                        </div>
                        <div class="line"></div>
                        <div class="form-group row">
                            <label class="col-sm-3 form-control-label">
                                <h3>公差(mm)</h3>
                            </label>
                            <div class="col-sm-9">
                                <input id="tolerance" type="text" class="form-control" placeholder="例: +0.005">
                                <small class="text-primary">请注意正负符号不要遗漏</small>
                            </div>
                        </div>
                        <div class="line"></div>
                        <div class="form-group row">
                            <label class="col-sm-3 form-control-label">
                                <h3>重量(kg)</h3>
                            </label>
                            <div class="col-sm-9">
                                <input id="weight" type="text" class="form-control" value="">
                            </div>
                        </div>
                        <div class="line"></div>
                        <div class="form-group row">
                            <label class="col-sm-3 form-control-label">
                                <h3>生产时间</h3>
                            </label>
                            <div class="col-sm-9">
                                <input id="arrange-date" type="date" class="form-control">
                            </div>
                        </div>
                        <div class="line"></div>
                        <div class="form-group row">
                            <label class="col-lg-3 col-sm-3 form-control-label">
                                <h3>班次</h3>
                            </label>
                            <div class="col-lg-2 col-sm-3">
                                <div class="i-checks">
                                    <input id="radioCustom2" type="radio" checked="" value="1" name="shift"
                                           class="radio-template">
                                    <label for="radioCustom2">早班</label>
                                </div>
                            </div>
                            <div class="col-lg-7 col-sm-3">
                                <div class="i-checks">
                                    <input id="radioCustom1" type="radio" value="0" name="shift"
                                           class="radio-template">
                                    <label for="radioCustom1">晚班</label>
                                </div>
                            </div>
                        </div>
                        <div class="line"></div>
                        <div class="form-group row">
                            <div class="col-lg-9 col-sm-9 ml-auto">
                                <button id="save-btn" type="submit" class="btn btn-outline-info">保存</button>
                                <button id="print-btn" type="submit" class="btn btn-outline-success">打印预览</button>
                                <button id="reset-btn" class="btn btn-outline-secondary">重置</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- javascript -->
<script src="js/function/arrange.js"></script>
<script type="text/javascript">
    $("#gauge-setting").click(function () {
        $("#modal-area").load("/sub/gauge.html");
        getAllGauge();
        $("#load-modal").modal("show");
    });

    $("#machine-setting").click(function () {
        $("#modal-area").load("/sub/machine.html");
        getAllMachine();
        $("#load-modal").modal("show");
    });

    function getAllGauge() {
        $.ajax({
            url: serverUrl + "/gauge",
            contentType: "application/json; charset=utf-8",
            beforeSend: function (XMLHttpRequest) {
                XMLHttpRequest.setRequestHeader("token", token);
            },
            type: "GET",
            success: function (result) {
                console.log(result);
                if (result.status === 0) {
                    showGaugeHad(result.data);
                } else {
                    Notiflix.Notify.Failure(result.msg);
                }
            }
        });
    }

    function getAllMachine() {
        $.ajax({
            url: serverUrl + "/machine",
            contentType: "application/json; charset=utf-8",
            beforeSend: function (XMLHttpRequest) {
                XMLHttpRequest.setRequestHeader("token", token);
            },
            type: "GET",
            success: function (result) {
                if (result.status === 0) {
                    showMachineHad(result.data)
                } else {
                    Notiflix.Notify.Failure(result.msg);
                }
            }
        });
    }

    function showGaugeHad(data) {
        $("#gauge-area").empty();
        $.each(data, function (index, item) {
            let gaugeDiv = $("<div class='delete-gauge' style='cursor: pointer;' data-placement='top' title='点击删除'></div>").append(item.gauge).attr("gauge-id", item.gaugeId);
            $("<div class='col-lg-2 col-sm-3 text-center'></div>").append(gaugeDiv).appendTo("#gauge-area");
        });
    }

    function showMachineHad(data) {
        $("#machine-area").empty();
        $.each(data, function (index, item) {
            let machineDiv = $("<div class='delete-machine' style='cursor: pointer;' data-placement='top'></div>")
                .append(item.machineNumber).attr({
                    "machine-id": item.machineId,
                    "title": "点击删除 [ " + item.machineName + " ]"
                });
            $("<div class='col-lg-2 col-sm-3 text-center'></div>").append(machineDiv).appendTo("#machine-area");
        });
    }

</script>