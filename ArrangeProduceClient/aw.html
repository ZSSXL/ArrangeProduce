<div class="page-header">
    <div class="container-fluid">
        <h2 class="h5 no-margin-bottom">退火机排产</h2>
    </div>
</div>
<section class="no-padding-top no-padding-bottom">

    <!-- 模态框 -->
    <div class="modal fade" tabindex="-1" role="dialog" id="load-modal-aw">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content" id="modal-area-aw">
                <!-- 模态框内容动态加载 -->
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <!-- 打印modal -->
    <div class="modal fade" tabindex="-1" role="dialog" id="detail-print-modal">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">PRINT 打印操作</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="print-btn-aw">
                    <!--<div class="row">
                            <div class="col-lg-6 col-sm-6">
                                <img id="qr-code" src="/img/photos/default.png">
                            </div>
                            <div class="col-lg-6 col-sm-6">
                                <h3>设备型号&nbsp;: <span id="machine-name"></span></h3>
                                <h3 id="group-number-value">&nbsp;</h3>
                                <h3>规格&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span id="gauge-value"></span>
                                    <strong>(mm)</strong></h3>
                                <h3>正公差&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: +<span id="positive-tolerance-value"></span>
                                </h3>
                                <h3>负公差&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: -<span id="negative-tolerance-value"></span>
                                </h3>
                                <h3>排单人&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span id="creator-value"></span></h3>
                                <h3>班次&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span id="shift-value"></span></h3>
                                <h3>生产时间&nbsp;: <span id="arrange-time"></span></h3>
                            </div>
                        </div>-->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-light" data-dismiss="modal">取消</button>
                    <button id="start-print" type="button" class="btn btn-primary">打印</button>
                </div>

                <script type="text/javascript">
                    $("#start-print").click(function () {
                        $("#print-btn-aw").print();
                    });
                </script>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <!-- 退火机排产详情 -->
    <div class="modal fade" tabindex="-1" role="dialog" id="aw-arrange-detail-modal">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <!-- 模态框内容动态加载 -->
                <div class="modal-header">
                    <h4 class="modal-title">ANNEALING 退火机排产详情</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="block-body">
                        <div class="form-group row">
                            <div class="col-lg-6 col-sm-6">
                                <div class="row">
                                    <h4 class="col-sm-4">线规<small>(mm)</small></h4>
                                    <div class="col-sm-8">
                                        <input type="text" placeholder="gauge"
                                               class="form-control form-control-success" id="detail-gauge-aw"
                                               value="0.0598">
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-sm-6">
                                <div class="row">
                                    <h4 class="col-sm-3">机器</h4>
                                    <div class="col-sm-9">
                                        <input type="text" placeholder="machine"
                                               class="form-control form-control-success" id="detail-machine-aw">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-2 form-control-label">
                                <h4>公差<small>(mm)</small></h4>
                            </label>
                            <div class="col-sm-4">
                                <div class="input-group">
                                    <div class="input-group-prepend display-none"><span
                                            class="input-group-text text-white">+</span>
                                    </div>
                                    <input id="detail-positive-tolerance-aw" type="text" placeholder="正公差"
                                           class="form-control">
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="input-group">
                                    <div class="input-group-prepend"><span
                                            class="input-group-text text-white">-</span>
                                    </div>
                                    <input id="detail-negative-tolerance-aw" type="text" placeholder="负公差"
                                           class="form-control">
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-lg-2 col-sm-3">
                                <h4>分组信息</h4>
                            </div>
                            <div class="col-lg-10 col-sm-9">
                                <div class="input-group">
                                    <input type="text" placeholder="group number" class="form-control"
                                           id="detail-group-number-aw">
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-lg-6 col-sm-6">
                                <div class="row">
                                    <h4 class="col-sm-4">生产时间</h4>
                                    <div class="col-sm-8">
                                        <input type="date" placeholder="arrange time"
                                               class="form-control form-control-success" id="detail-arrange-time-aw">
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-sm-6">
                                <div class="row">
                                    <h4 class="col-sm-3">班次</h4>
                                    <div class="col-sm-9">
                                        <input type="text" placeholder="shift"
                                               class="form-control form-control-success" id="detail-shift-aw">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-lg-6 col-sm-6">
                                <div class="row">
                                    <h4 class="col-sm-4">创建时间</h4>
                                    <div class="col-sm-8">
                                        <input type="text" disabled="" placeholder="create time"
                                               class="form-control form-control-success" id="detail-create-time-aw">
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-sm-6">
                                <div class="row">
                                    <h4 class="col-sm-3">创建人</h4>
                                    <div class="col-sm-9">
                                        <input type="text" disabled="" placeholder="creator"
                                               class="form-control form-control-success" id="detail-creator-aw">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-lg-6 col-sm-6">
                                <div class="row">
                                    <h4 class="col-sm-4">打印状态</h4>
                                    <div class="col-sm-8">
                                        <input type="text" disabled="" placeholder="print status"
                                               class="form-control form-control-success" id="detail-print-aw">
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-sm-6">
                                <div class="row">
                                    <h4 class="col-sm-3">推送</h4>
                                    <div class="col-sm-9">
                                        <input type="text" disabled="" placeholder="push status"
                                               class="form-control form-control-success" id="detail-push-aw">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-info" id="modify-aw">修改</button>
                    <button type="button" class="btn btn-outline-warning" id="print-history">打印</button>
                    <button type="button" class="btn btn-outline-light" data-dismiss="modal">Close</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <!-- 排产打印 -->
    <div class="container-fluid block">
        <div class="row">
            <!-- Form Elements -->
            <div class="col-lg-12">
                <div class="block-body">
                    <div class="form-group row">
                        <label class="col-lg-2 col-sm-2 form-control-label">
                            <h4 class="text-white">位置选择</h4>
                        </label>
                        <div class="col-lg-2 col-sm-3">
                            <div class="i-checks">
                                <input id="sort-annealing" type="radio" checked="" value="annealing" name="sort"
                                       class="radio-template">
                                <label for="sort-annealing">放线端</label>
                            </div>
                        </div>
                        <div class="col-lg-2 col-sm-3">
                            <div class="i-checks">
                                <input id="sort-winding" type="radio" value="winding" name="sort"
                                       class="radio-template">
                                <label for="sort-winding">收线端</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-lg-2 col-sm-2 form-control-label">
                            <h4 class="text-white">设备</h4>
                        </label>
                        <div class="col-lg-7 col-sm-7">
                            <select id="machine-aw" name="machine" class="form-control mb-3 mb-3">
                            </select>
                        </div>
                        <div class="col-lg-2 col-sm-2">
                            <button class="btn btn-outline-warning" id="machine-setting-aw">设置</button>
                        </div>
                    </div>
                    <div class="line"></div>
                    <div class="form-group row">
                        <label class="col-lg-2 col-sm-3 form-control-label">
                            <h4 class="text-white">分组选择</h4>
                        </label>
                        <div class="col-lg-7 col-sm-7">
                            <select id="group" name="gauge" class="form-control">
                            </select>
                        </div>
                        <div class="col-lg-2 col-sm-2">
                            <button class="btn btn-outline-warning" id="group-setting">设置</button>
                        </div>
                    </div>
                    <div class="line"></div>
                    <div class="form-group row">
                        <label class="col-lg-2 col-sm-3 form-control-label">
                            <h4 class="text-white">规格(mm)</h4>
                        </label>
                        <div class="col-lg-7 col-sm-7">
                            <select id="gauge-aw" name="gauge" class="form-control mb-3 mb-3">
                            </select>
                        </div>
                        <div class="col-lg-2 col-sm-2">
                            <button class="btn btn-outline-warning" id="gauge-setting-aw">设置</button>
                        </div>
                    </div>
                    <div class="line"></div>
                    <div class="form-group row">
                        <label class="col-sm-2 form-control-label">
                            <h4 class="text-white">正公差(mm)</h4>
                        </label>
                        <div class="col-sm-8">
                            <div class="input-group">
                                <input id="positive-tolerance" type="text" placeholder="请输入正公差"
                                       class="form-control">
                            </div>
                        </div>
                    </div>
                    <div class="line"></div>
                    <div class="form-group row">
                        <label class="col-sm-2 form-control-label">
                            <h4 class="text-white">负公差(mm)</h4>
                        </label>
                        <div class="col-sm-8">
                            <div class="input-group">
                                <input id="negative-tolerance" type="text" placeholder="请输入负公差" class="form-control">
                            </div>
                        </div>
                    </div>
                    <div class="line"></div>
                    <div class="form-group row">
                        <label class="col-sm-2 form-control-label">
                            <h4 class="text-white">生产时间</h4>
                        </label>
                        <div class="col-sm-4">
                            <input id="arrange-date-aw" type="date" class="form-control">
                        </div>
                    </div>
                    <div class="line"></div>
                    <div class="form-group row">
                        <label class="col-lg-2 col-sm-2 form-control-label">
                            <h4 class="text-white">班次</h4>
                        </label>
                        <div class="col-lg-2 col-sm-3">
                            <div class="i-checks">
                                <input id="radioCustom2" type="radio" checked="" value="1" name="shift-aw"
                                       class="radio-template">
                                <strong for="radioCustom2">A 班</strong>
                            </div>
                        </div>
                        <div class="col-lg-3 col-sm-3">
                            <div class="i-checks">
                                <input id="radioCustom1" type="radio" value="0" name="shift-aw"
                                       class="radio-template">
                                <strong for="radioCustom1">B 班</strong>
                            </div>
                        </div>
                    </div>
                    <div class="line"></div>
                    <div class="form-group row">
                        <div class="col-lg-10 col-sm-10 ml-auto">
                            <button id="save-btn-aw" type="submit" class="btn btn-outline-info">保存</button>
                            <button id="reset-btn-aw" class="btn btn-outline-secondary">重置</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<section class="no-padding-top no-padding-bottom">
    <div class="container-fluid block" id="load-area">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12">
                <div class="row">
                    <div class="col-lg-3 col-sm-3">
                        <div class="input-group">
                            <div class="input-group-prepend"><span class="input-group-text text-white"><i
                                    class="icon-magnifying-glass-browser"></i></span></div>
                            <input id="input-filter-aw" type="text" placeholder="输入过滤条件" class="form-control">
                        </div>
                    </div>
                    <div class="col-lg-7 col-sm-7">
                        <button class="btn quick-click" style="background:#90c5f0;color:#fff;" tag-id="A班">A班</button>
                        <button class="btn quick-click" style="background:#8E388E;color:#fff;" tag-id="B班">B班</button>
                        <button class="btn quick-click" style="background:#A2CD5A;color:#fff;" tag-id="已推送">已推送</button>
                        <button class="btn quick-click" style="background:#FFA500;color:#fff;" tag-id="未推送">未推送</button>
                        <button class="btn quick-click" style="background:#00C5CD;color:#fff;" tag-id="">重置</button>
                    </div>
                    <div class="col-lg-2 col-sm-2">
                        <button class="btn btn-warning btn-lg" style="float: right;" id="push-aw">推送</button>
                    </div>
                </div>
                <hr/>
                <div class="row">
                    <table class="table table-striped table-sm">
                        <thead class="text-center text-white">
                        <tr>
                            <th class="sorter-false">全选<input type="checkbox" id="ck-aw"></th>
                            <th class="sorter-false">#</th>
                            <th class="sorter-false">设备</th>
                            <th>收放线编号(mm)</th>
                            <th>线规(mm)</th>
                            <th>正公差(mm)</th>
                            <th>负公差(mm)</th>
                            <th>生产时间</th>
                            <th class="sorter-false">班次</th>
                            <th class="sorter-false">推送状态</th>
                            <th class="sorter-false">操作</th>
                        </tr>
                        </thead>
                        <tbody id="aw-arrange-history-area" class="text-center">
                        </tbody>
                    </table>
                </div>
                <div class="text-center">
                    <div class="row">
                        <div class="col-lg-12 col-sm-12 text-center">
                            <h3 id="no-message-aw">没有数据</h3>
                        </div>
                    </div>
                    <div class="row text-center" id="nav-message-aw">
                        <!-- 分页信息 -->
                        <!-- 分页文字信息 -->
                        <div class="col-lg-12 col-sm-12" id="page_info_area_aw"
                             style="text-align: center; margin-bottom: 10px;">
                        </div>
                        <!-- 分页条信息 -->
                        <div class="col-lg-12 col-sm-12" style="display: inline-block; text-align: center;">
                            <nav id="page-ul-aw">
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- javascript -->
<script src="js/function/aw.js"></script>
<script src="js/jquery.tablesorter.min.js"></script>
<script type="text/javascript">

    $("#sort-annealing").change(function () {
        machineSort = $(this).val();
        getAllMachineAnnealing();
    });

    $("#sort-winding").change(function () {
        machineSort = $(this).val();
        getAllMachineWinding();
    });

    $("#gauge-setting-aw").click(function () {
        $("#modal-area-aw").load("/sub/gauge.html");
        getAllGauge();
        $("#load-modal-aw").modal("show");
    });

    $("#group-setting").click(function () {
        $("#modal-area-aw").load("/sub/group.html");
        getAllGroupSetting();
        $("#load-modal-aw").modal("show");
    });

    function getAllGauge() {
        $.ajax({
            url: serverUrl + "/gauge",
            contentType: "application/json; charset=utf-8",
            beforeSend: function (XMLHttpRequest) {
                XMLHttpRequest.setRequestHeader("token", token);
            },
            type: "GET",
            success: function (result) {
                if (result.status === 0) {
                    showGaugeHad(result.data);
                } else {
                    Notiflix.Notify.Failure(result.msg);
                }
            }
        });
    }

    function showGaugeHad(data) {
        $("#gauge-area").empty();
        $.each(data, function (index, item) {
            let gaugeDiv = $("<div class='delete-gauge' style='cursor: pointer;' data-placement='top' title='点击删除'></div>").append(item.gauge.toFixed(3)).attr("gauge-id", item.gaugeId);
            $("<div class='col-lg-2 col-sm-3 text-center'></div>").append(gaugeDiv).appendTo("#gauge-area");
        });
    }

    function getAllMachine(sort) {
        $.ajax({
            url: serverUrl + "/machine/" + sort,
            contentType: "application/json; charset=utf-8",
            beforeSend: function (XMLHttpRequest) {
                XMLHttpRequest.setRequestHeader("token", token);
            },
            type: "GET",
            success: function (result) {
                if (result.status === 0) {
                    showMachineHad(result.data)
                } else {
                    Notiflix.Notify.Failure(result.msg);
                }
            }
        });
    }

    function showMachineHad(data) {
        $("#machine-area").empty();
        $.each(data, function (index, item) {
            let machineDiv = $("<div class='delete-machine' style='cursor: pointer;' data-placement='top'></div>")
                .append(item.machineName + "(" + item.machineNumber + ")").attr({
                    "machine-id": item.machineId,
                    "title": "点击删除"
                });
            $("<div class='col-lg-2 col-sm-3 text-center'></div>").append(machineDiv).appendTo("#machine-area");
        });
    }

    function getAllGroupSetting() {
        $.ajax({
            url: serverUrl + "/group",
            beforeSend: function (XMLHttpRequest) {
                XMLHttpRequest.setRequestHeader("token", token);
            },
            type: "GET",
            success: function (result) {
                if (result.status === 0) {
                    showAllGroupInSetting(result.data);
                } else {
                    Notiflix.Notify.Failure(result.msg);
                }
            }
        });
    }

    function showAllGroupInSetting(data) {
        $("#group-area").empty();
        $.each(data, function (index, item) {
            let groupDiv = $("<div class='delete-group' style='cursor: pointer;' data-placement='top'></div>")
                .append(item.groupNumber).attr({
                    "group-id": item.groupId,
                    "title": "[点击删除]"
                });
            $("<div class='col-lg-2 col-sm-4 text-center'></div>").append(groupDiv).appendTo("#group-area");
        });
    }

    $(function () {
        $("table").tablesorter({
            sortReset: true
        });

        $("#input-filter-aw").keyup(function () {
            filterTable($(this).val());
        }).keyup();


        $("#arrange-date-aw").val(printTimeFormat(new Date()));
        // $("#group-detail").text($("#group option:selected").val());
    });

    $(".quick-click").click(function () {
        let tag = $(this).attr("tag-id");
        filterTable(tag);
    });

    function filterTable(val) {
        $("table tbody tr").hide()
            .filter(":contains('" + (val) + "')").show();//filter和contains共同来实现了这个功能。
    }

</script>